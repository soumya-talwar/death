<html>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>death bot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rita/2.4.501/rita.js" integrity="sha512-TQiVcIaGGx6Ct1D/ghNQC/r6PsV+nLxOST0cCfk4kyw9300JDXuXZqdGGg63nlNn885/7GVZ2lBbRu9Nxz5QRA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js" integrity="sha512-N4kV7GkNv7QR7RX9YF/olywyIgIwNvfEe2nZtfyj73HdjCUkAfOBDbcuJ/cTaN04JKRnw1YG1wnUyNKMsNgg3g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <script>
      var charrnn;
      var sentiment;
      var starts = [];

      function setup() {
        charrnn = ml5.charRNN("./char-rnn/models/input", () => console.log("charrnn model ready!"));
        sentiment = ml5.sentiment("movieReviews", () => console.log("sentiment model ready!"));
        fetch("http://127.0.0.1:3000/text/tweets.txt")
          .then(response => response.text())
          .then(text => {
            let sentences = RiTa.sentences(text);
            for (sentence of sentences) {
              let words = sentence.split(" ");
              starts.push(words[0]);
            }
            console.log("text is fetched!");
          });
      }

      async function generate() {
        let tweet = "";
        let start = starts[Math.floor(Math.random() * starts.length)] + " ";
        await charrnn.generate({
          seed: start,
          length: Math.floor(Math.random() * (280 - 100) + 100),
          temperature: 0.5
        }, (error, result) => {
          tweet = start + result.sample;
          // let prediction = sentiment.predict(tweet).score;
        });
        return tweet;
      }
    </script>
  </head>

</html>